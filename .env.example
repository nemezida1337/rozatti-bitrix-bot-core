# ====== Server ======
PORT=8080
BASE_URL=https://your-public-https-host

# ====== Logs ======
LOG_DIR=./logs
LOG_LEVEL=info

# ====== OAuth app (Bitrix Local App) ======
BITRIX_CLIENT_ID=
BITRIX_CLIENT_SECRET=
BITRIX_OAUTH_URL=https://oauth.bitrix.info/oauth/token/
BITRIX_OAUTH_REDIRECT=${BASE_URL}/oauth/callback
# 1 = debug-probe через profile (лог текущего REST-пользователя), 0 = выключено
BITRIX_DEBUG_PROFILE=0

# ====== Incoming events security ======
# Опционально: защита /bitrix/events (query secret=... или header x-hf-events-token)
BITRIX_EVENTS_SECRET=
# 1 = сверять application_token события с сохраненным в store
BITRIX_VALIDATE_APP_TOKEN=0
# 1 = временно обрабатывать onimmessageadd (по умолчанию только onimbotmessageadd)
BITRIX_ALLOW_ONIMMESSAGEADD=0

# ====== Storage ======
TOKENS_FILE=./data/portals.json
# In-process cache TTL for session snapshots (ms)
SESSION_CACHE_TTL_MS=3000
# In-process cache TTL for portal token store snapshots (ms)
STORE_CACHE_TTL_MS=1500
# Optional distributed state (Redis) for multi-instance locks/idempotency
REDIS_URL=
REDIS_KEY_PREFIX=bitrixbot
REDIS_ENABLED=1

# ====== Bot ======
BOT_CODE=ram_parts_bot
BOT_NAME=RAM Parts Bot
BOT_OPENLINES_WELCOME=Добро пожаловать! Напишите VIN или номер детали.
# O = Open Lines бот (по умолчанию), B = chat bot (для диагностики)
BOT_TYPE=O

# ====== OpenAI / LLM ======
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4.1-mini
LLM_MODEL=gpt-4.1-mini
LLM_MODEL_STRUCTURED=gpt-4.1-mini
LLM_CURRENCY=₽

# ====== ABCP ======
ABCP_HOST=
ABCP_DOMAIN=
ABCP_USERLOGIN=
ABCP_USERPSW_MD5=
ABCP_KEY=
ABCP_PROFILE_ID=

# ====== HF-CORTEX integration ======
HF_CORTEX_ENABLED=true
HF_CORTEX_URL=http://127.0.0.1:9000/api/hf-cortex/lead_sales
HF_CORTEX_TIMEOUT_MS=20000
HF_CORTEX_API_KEY=change-me
# cortex = квалификация в Python Cortex (рекомендуется), node = legacy-эвристики в Node
HF_CORTEX_CLASSIFIER_SOURCE=cortex
# Приоритетнее HF_CORTEX_CLASSIFIER_SOURCE: 1 включает legacy-классификацию в Node
NODE_LEGACY_CLASSIFICATION=0
# Canary rollout Cortex-классификации по dialogId (0..100). 100 = все через Cortex.
HF_CORTEX_CANARY_PERCENT=100
# Shadow-сравнение legacy vs Cortex (только логи, без влияния на ответы).
HF_CORTEX_SHADOW_COMPARE=0
# Сэмплирование shadow-логов (0..100), если HF_CORTEX_SHADOW_COMPARE=1.
HF_CORTEX_SHADOW_SAMPLE_PERCENT=100
# Логировать также совпавшие shadow-решения (0/1).
HF_CORTEX_SHADOW_LOG_MATCH=0
# Быстрый OEM-путь в Node (legacy-оптимизация). Для Cortex-first держать 0.
NODE_FAST_OEM_PATH=0
# Distributed dialog lock (when REDIS_URL is set)
BOT_DIALOG_LOCK_TTL_MS=45000
BOT_DIALOG_LOCK_WAIT_MS=45000
BOT_DIALOG_LOCK_POLL_MS=120

# ====== Diagnostics dumps ======
# На проде лучше выключить (0), включать временно при расследовании
EVENT_DUMP=0
EVENT_DUMP_RAW=0
EVENT_DUMP_DIR=./data/events
HF_CORTEX_DUMP=0
HF_CORTEX_DUMP_DIR=./data/cortex

# ====== ABCP order distributed lock ======
ABCP_ORDER_LOCK_TTL_MS=45000
ABCP_ORDER_LOCK_WAIT_MS=45000
ABCP_ORDER_LOCK_POLL_MS=120
